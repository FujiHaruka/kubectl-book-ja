



{% panel style="info", title="TL;DR" %}
- Kubectl は Kubernetes CLI です
- Kubectl は Kubernetes クラスタを扱うための十徳ナイフです
- Kubectl は Kubernetes 上のアプリケーションをデプロイ・管理するのに使います
- Kubectl はより高レベルのフレームワークを書き、構築するために使うこともできます
{% endpanel %}

# Kubectl

Kubectl は Kubenetes の CLI バージョンで、多くのことができる十徳ナイフです。

この本は Kubectl を使って Kubernetes 内のアプリケーションを宣言的に管理することにフォーカスしていますが、Kubectl の他の機能も網羅しています。

## コマンドの分類

ほとんどの Kubectl コマンドは一般的に以下のカテゴリの一つに分類されます。

| 種類                                   | 用途                   | 説明                                        |
|----------------------------------------|----------------------------|----------------------------------------------------|
| 宣言的なリソース管理        | デプロイと (GitOps のような) オペレーション   | Resource Config を使った Kubernetes ワークロードを宣言的に管理する     |
| 命令的なリソース管理         | デプロイのみ           | コマンドラインで引数とフラグを使って Kubernetes ワークロードを管理するコマンドを実行する |
| ワークロードの状態を表示 | デバッグ  | ワークロードについての情報を表示する |
| コンテナの相互作用 | デバッグ  | Exec、Attach、Cp、Logs |
| クラスタ管理 | クラスタ Ops | Drain and Cordon Nodes |

## 宣言的なアプリケーション管理

リソースを管理する方法は、Resource Config という名前の宣言的なファイルを置き、Kubectl *Apply* コマンドで管理するのを推奨します。このコマンドはローカル (リモートでも可) にあるファイル構造を読み込み、宣言通りの意図をくみ取ってクラスタの状態を変更します。

{% panel style="info", title="Apply" %}
Apply は Kubernetes のリソースを管理するための推奨の方法です。
{% endpanel %}

## ワークロードの状態を表示

ワークロードの状態を見ることが必要になる場合があります。

- リソースの状態とその情報を要約して表示する
- リソースの状態とその情報を完全に表示する
- リソースから特定のフィールドを表示する
- ラベルにマッチするリソースを検索する

## ワークロードのデバッグ

Kubectl はデバッグをサポートするコマンドを提供しています。

- コンテナのログを表示する
- クラスタのイベントを表示する
- コンテナに対して Exec やアタッチを実行する
- クラスタ内のコンテナにあるファイルをユーザーのファイルシステムにコピーする

## クラスタ管理

時には、クラスタの Node に操作を実行する必要があります。Kubectl は Node からワークロードをドレイン？するコマンドをサポートしています。それを使うと、ワークロードを停止したりデバッグしたりできます。

## Porcelain

Resource Config を使うのは**開発**用には冗長にすぎると感じる人がいるかもしれません。そういうときには、シェルのようなワークフローでクラスタを**命令的に**扱いたくなります。Kubectl はリソースを生成・変更するための porcelain な (訳注: ユーザーフレンドリーな) コマンドを提供しています。

- Deployment、StatefulSet、Service、ConfigMap などのリソースを生成・作成する
- リソースにフィールドを設定する
- テキストエディタでリソースを (稼働させたまま) 編集する

{% panel style="danger", title="開発用" %}
porcelain なコマンドは開発用クラスタ内でワークロードを試行錯誤するのに時間の節約になりますが、本番で使うべきではありません。
{% endpanel %}
