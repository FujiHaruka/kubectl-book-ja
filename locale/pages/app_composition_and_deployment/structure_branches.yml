texts:
  en: >-
    {% panel style="success", title="Providing Feedback" %}

    **Provide feedback at the [survey](https://www.surveymonkey.com/r/JH35X82)**
  ja: __COPY__
---
texts:
  en: >-
    {% panel style="warning", title="Experimental" %}

    **Content in this chapter is experimental and will evolve based on user feedback.**
  ja: __COPY__
---
texts:
  en: >-
    Leave feedback on the conventions by creating an issue in the [kubectl](https://github.com/kubernetes/kubectl/issues)

    GitHub repository.
  ja: __COPY__
---
texts:
  en: Also provide feedback on new kubectl docs at the [survey](https://www.surveymonkey.com/r/JH35X82)
  ja: __COPY__
---
texts:
  en: >-
    {% panel style="info", title="TL;DR" %}

    Decouple changes to Config to be deployed to separate Environments.
  ja: __COPY__
---
texts:
  en: Branch Structure Based Layout
  ja: __COPY__
---
texts:
  en: Motivation
  ja: __COPY__
---
texts:
  en: >-
    **Why use branches?** Decouple changes that are rolled out with releases (e.g. new flags) from changes that are

    rolled out in response to production events (e.g. resource tuning).
  ja: __COPY__
---
texts:
  en: Branch Structure
  ja: __COPY__
---
texts:
  en: The convention shown here should be changed and adapted as needed.
  ja: __COPY__
---
texts:
  en: Branch Type Name
  ja: __COPY__
---
texts:
  en: Deployed to a Cluster
  ja: __COPY__
---
texts:
  en: Purpose
  ja: __COPY__
---
texts:
  en: Example Config Change
  ja: __COPY__
---
texts:
  en: Example Branch Name
  ja: __COPY__
---
texts:
  en: Base
  ja: __COPY__
---
texts:
  en: "**No**.  Merged into other Branches only."
  ja: __COPY__
---
texts:
  en: Changes that should be rolled out as part of a release.
  ja: __COPY__
---
texts:
  en: Add *pubsub topic* flag
  ja: __COPY__
---
texts:
  en: "`master`, `release-1.14`, `i1026`"
  ja: __COPY__
---
texts:
  en: Deploy
  ja: __COPY__
---
texts:
  en: "**Yes**. - Manually or Continuously."
  ja: __COPY__
---
texts:
  en: Base + Changes required to respond to "production" events (or dev, staging, etc).
  ja: __COPY__
---
texts:
  en: Increase *memory resources* - e.g. for crashing Containers
  ja: __COPY__
---
texts:
  en: "`deploy-test`, `deploy-staging`, `deploy-prod`"
  ja: __COPY__
---
texts:
  en: Use with techniques described in [Directories](structure_directories.md) and [Branches](structure_branches.md)
  ja: __COPY__
---
texts:
  en: Workflow Example
  ja: __COPY__
---
texts:
  en: Diagram
  ja: __COPY__
---
texts:
  en: Scenario
  ja: __COPY__
---
texts:
  en: Live Prod App version is *v1*
  ja: __COPY__
---
texts:
  en: "*v2* changes committed to Base Branch Config"
  ja: __COPY__
---
texts:
  en: "*v2* rolled out to Staging"
  ja: __COPY__
---
texts:
  en: Deployed by continuous deployment
  ja: __COPY__
---
texts:
  en: Live Prod App requires change to *v1* (unrelated to *v2*)
  ja: __COPY__
---
texts:
  en: Change memory resources in Prod
  ja: __COPY__
---
texts:
  en: Prod Branch Config Updated at *v1*
  ja: __COPY__
---
texts:
  en: Deployed immediately by continuous deployment
  ja: __COPY__
---
texts:
  en: "*v2* changes rolled out separately"
  ja: __COPY__
---
texts:
  en: Tag on Base Branch merged into Prod Branch
  ja: __COPY__
---
texts:
  en: Prod Branch continuously deployed
  ja: __COPY__
---
texts:
  en: "{% sequence width=1000 %}"
  ja: __COPY__
---
texts:
  en: >-
    participant Base Branch as BB

    participant Staging Branch as SB

    participant Staging Clusters as SC

    participant Prod Branch as PB

    participant Prod Clusters as PC
  ja: __COPY__
---
texts:
  en: >-
    Note over SC: At v1 release

    Note over PC: At v1 release

    Note left of BB: Bob: App Dev

    Note over BB: Bob Adds Flag

    Note over BB: Bob Tags v2

    Note over SB: Bob Releases v2

    BB-->SB: Merge v2

    SB-->SC: Deploy

    Note over SC: At v2 release

    Note over BB,PC: Prod Outage

    Note left of PB: Alice: App SRE

    Note over PB: Alice fixes Config

    PB-->PC: Alice's changes (only)

    Note over PC: At v1* release

    Note over BB,PC: Prod Outage resolved

    Note over PB: Alice Releases v2

    BB-->PB: Merge v2

    PB-->PC: Deploy v2

    Note over PC: At v2 release
  ja: __COPY__
---
texts:
  en: Description
  ja: __COPY__
---
texts:
  en: "**Note:** Starting version of Application is *v1*"
  ja: __COPY__
---
texts:
  en: Developer Bob introduces new app flag for release with *v2*
  ja: __COPY__
---
texts:
  en: e.g. PubSub topic name
  ja: __COPY__
---
texts:
  en: Bob updates the Base Config with the new flag
  ja: __COPY__
---
texts:
  en: Add staging topic for Staging (e.g. `staging-topic`)
  ja: __COPY__
---
texts:
  en: Add prod topic for Prod (e.g. `prod-topic`)
  ja: __COPY__
---
texts:
  en: Flag should be rolled out with *v2* release
  ja: __COPY__
---
texts:
  en: "*v2* is cut"
  ja: __COPY__
---
texts:
  en: Base tagged with *v2* tag
  ja: __COPY__
---
texts:
  en: Merge *v2* Tag -> Staging Branch
  ja: __COPY__
---
texts:
  en: Deploy Staging Branch to Staging Clusters
  ja: __COPY__
---
texts:
  en: SRE Alice identifies issue in Prod (at *v1*)
  ja: __COPY__
---
texts:
  en: Fix is to increase memory of containers
  ja: __COPY__
---
texts:
  en: Alice updates the Prod branch Config by increasing memory resources
  ja: __COPY__
---
texts:
  en: Changes go directly into Prod Branch without going into Base
  ja: __COPY__
---
texts:
  en: "*v1* changes rolled out to Prod (*v1++*)"
  ja: __COPY__
---
texts:
  en: Include Alice's changes, but not Bob's
  ja: __COPY__
---
texts:
  en: "*v2* rolled out to Prod"
  ja: __COPY__
---
texts:
  en: Merge *v2* Tag -> Prod Branch
  ja: __COPY__
---
texts:
  en: Deploy Prod Branch to Prod Clusters
  ja: __COPY__
---
texts:
  en: "Techniques:"
  ja: __COPY__
---
texts:
  en: >-
    Add new required flags and environment variables to the Resource Config in the Base branch at the
      time they are added to the code.
  ja: __COPY__
---
texts:
  en: Will be rolled out when the code is rolled out.
  ja: __COPY__
---
texts:
  en: Adjust flags and configuration to the Resource Config in the Deploy branch in the deploy directory.
  ja: __COPY__
---
texts:
  en: Will be rolled out immediately independent of versions.
  ja: __COPY__
---
texts:
  en: Merge code from the Base branch to the Deploy branches to perform a Rollout.
  ja: __COPY__
---
texts:
  en: Directory and Branch Layout
  ja: __COPY__
---
texts:
  en: "Structure:"
  ja: __COPY__
---
texts:
  en: Base branch (e.g. `master`, `app-version`, etc) for Config changes tied to releases.
  ja: __COPY__
---
texts:
  en: Looks like [Directories](structure_directories.md)
  ja: __COPY__
---
texts:
  en: Separate Deploy branches for separate Environments (e.g. `deploy-<env>`).
  ja: __COPY__
---
texts:
  en: A new **Directory in each branch with will contain overlay customizations** - e.g. `deploy-<env>`.
  ja: __COPY__
---
texts:
  en: '{% sample lang="yaml" %}'
  ja: __COPY__
---
texts:
  en: "**Base Branch:** `master`"
  ja: __COPY__
---
texts:
  en: "**Deploy Branches:**"
  ja: __COPY__
---
texts:
  en: "Prod Branch: `deploy-prod`"
  ja: __COPY__
---
texts:
  en: "Staging Branch: `deploy-staging`"
  ja: __COPY__
---
texts:
  en: "Test Branch: `deploy-test`"
  ja: __COPY__
---
texts:
  en: Rollback Workflow Example
  ja: __COPY__
---
texts:
  en: "Summary of rollback workflow with Branches:"
  ja: __COPY__
---
texts:
  en: Changes are introduced to Base Branch Config
  ja: __COPY__
---
texts:
  en: To be released with version *v2*
  ja: __COPY__
---
texts:
  en: Release *v2* is cut to be rolled out
  ja: __COPY__
---
texts:
  en: Tag Base *v2* and build artifacts (e.g. images)
  ja: __COPY__
---
texts:
  en: Changes are introduced into the Base Branch Confiug
  ja: __COPY__
---
texts:
  en: To be released with version *v3*
  ja: __COPY__
---
texts:
  en: "*v2* is pushed to Prod (eventually)"
  ja: __COPY__
---
texts:
  en: "*v2* Tag merged into Prod Branch"
  ja: __COPY__
---
texts:
  en: "*v2* has issues in Prod and must be rolled back"
  ja: __COPY__
---
texts:
  en: "*v2* changes are rolled back in new commit to Prod Branch"
  ja: __COPY__
---
texts:
  en: Base Branch is unaffected
  ja: __COPY__
---
texts:
  en: Fix introduced in *v3*
  ja: __COPY__
---
texts:
  en: >-
    **Note:** New changes committed to the Base for "v3" did not make the rollback from

    "v2" -> "v1" more challenging, as they had not been merged into the Prod Branch.
  ja: __COPY__
---
texts:
  en: >-
    Note over SC: At v1 release

    Note over PC: At v1 release

    Note left of BB: Bob: App Dev

    Note over BB: Bob Adds Flag (for v2)

    Note over BB: Bob Tags v2

    Note over SB: Bob Releases v2

    BB-->SB: Merge v2

    SB-->SC: Deploy

    Note over SC: At v2 release

    Note over SB: Bob Adds another Flag (for v3)

    Note over PB: Bob Releases v2

    BB-->PB: Merge v2

    PB-->PC: Deploy v2

    Note over PC: At v2 release

    Note over BB,PC: Unrelated Prod Outage

    Note left of PB: Alice: App SRE

    Note over PB: Alice rolls back v2 merge commit

    PB-->PC: Deploy v1

    Note over PC: At v1 release

    Note over BB,PC: Prod Outage resolved
  ja: __COPY__
